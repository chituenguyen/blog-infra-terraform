┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                      INTERNET                                           │
└─────────────────────────────────────────┬───────────────────────────────────────────────┘
                                          │
                    ┌─────────────────────┴─────────────────────┐
                    │            Elastic IP (Public)            │
                    │              x.x.x.x                       │
                    └─────────────────────┬─────────────────────┘
                                          │
        ┌─────────────────────────────────┼─────────────────────────────────┐
        │                                 │                                 │
        ▼                                 ▼                                 ▼
   ┌─────────┐                      ┌──────────┐                      ┌──────────┐
   │UDP:51820│                      │ TCP:80   │                      │ TCP:443  │
   │WireGuard│                      │  HTTP    │                      │  HTTPS   │
   │ (VPN)   │                      │ (public) │                      │ (public) │
   └────┬────┘                      └────┬─────┘                      └────┬─────┘
        │                                │                                 │
┌───────┴────────────────────────────────┴─────────────────────────────────┴───────────────┐
│                                                                                          │
│                              AWS VPC (10.0.0.0/16)                                       │
│                              Region: ap-southeast-1                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                         Public Subnet (10.0.1.0/24)                                │  │
│  │                         AZ: ap-southeast-1a                                        │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                      EC2 Instance (t3.small)                                 │  │  │
│  │  │                      Name: blog-k3s-server                                   │  │  │
│  │  │                      Private IP: 10.0.1.x                                    │  │  │
│  │  │                      OS: Ubuntu 22.04 LTS                                    │  │  │
│  │  │                      Storage: 30GB gp3                                       │  │  │
│  │  │                                                                              │  │  │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────┐ │  │  │
│  │  │  │                    WireGuard VPN (wg0 interface)                        │ │  │  │
│  │  │  │                    Server IP: 10.10.0.1/24                              │ │  │  │
│  │  │  │                    Port: UDP 51820                                      │ │  │  │
│  │  │  │  ┌───────────────────────────────────────────────────────────────────┐  │ │  │  │
│  │  │  │  │ Registered Peers:                                                 │  │ │  │  │
│  │  │  │  │   • user1 → 10.10.0.2/32                                          │  │ │  │  │
│  │  │  │  │   • user2 → 10.10.0.3/32                                          │  │ │  │  │
│  │  │  │  │   • user3 → 10.10.0.4/32                                          │  │ │  │  │
│  │  │  │  └───────────────────────────────────────────────────────────────────┘  │ │  │  │
│  │  │  └──────────────────────────────────┬──────────────────────────────────────┘ │  │  │
│  │  │                                     │                                        │  │  │
│  │  │                          VPN Tunnel │ (encrypted)                            │  │  │
│  │  │                                     ▼                                        │  │  │
│  │  │  ┌──────────────────────────────────────────────────────────────────────────┐│  │  │
│  │  │  │                         K3s Server (Single Node)                         ││  │  │
│  │  │  │  ┌────────────────────────────────────────────────────────────────────┐  ││  │  │
│  │  │  │  │                      Control Plane                                 │  ││  │  │
│  │  │  │  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌───────────┐  │  ││  │  │
│  │  │  │  │  │  API Server  │ │  Controller  │ │  Scheduler   │ │   etcd    │  │  ││  │  │
│  │  │  │  │  │    :6443     │ │   Manager    │ │              │ │ (SQLite)  │  │  ││  │  │
│  │  │  │  │  │  VPN only    │ │              │ │              │ │           │  │  ││  │  │
│  │  │  │  │  └──────────────┘ └──────────────┘ └──────────────┘ └───────────┘  │  ││  │  │
│  │  │  │  └────────────────────────────────────────────────────────────────────┘  ││  │  │
│  │  │  │  ┌────────────────────────────────────────────────────────────────────┐  ││  │  │
│  │  │  │  │                      Worker Components                             │  ││  │  │
│  │  │  │  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────────┐    │  ││  │  │
│  │  │  │  │  │   Kubelet    │ │  Kube-proxy  │ │   Container Runtime      │    │  ││  │  │
│  │  │  │  │  │              │ │              │ │   (containerd)           │    │  ││  │  │
│  │  │  │  │  └──────────────┘ └──────────────┘ └──────────────────────────┘    │  ││  │  │
│  │  │  │  └────────────────────────────────────────────────────────────────────┘  ││  │  │
│  │  │  │  ┌────────────────────────────────────────────────────────────────────┐  ││  │  │
│  │  │  │  │                      Built-in Addons                               │  ││  │  │
│  │  │  │  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────────┐    │  ││  │  │
│  │  │  │  │  │   Traefik    │ │   CoreDNS    │ │  Local Path Provisioner  │    │  ││  │  │
│  │  │  │  │  │   Ingress    │ │  (DNS)       │ │  (Storage)               │    │  ││  │  │
│  │  │  │  │  │  :80/:443    │ │              │ │                          │    │  ││  │  │
│  │  │  │  │  │  (public)    │ │              │ │                          │    │  ││  │  │
│  │  │  │  │  └──────────────┘ └──────────────┘ └──────────────────────────┘    │  ││  │  │
│  │  │  │  └────────────────────────────────────────────────────────────────────┘  ││  │  │
│  │  │  │  ┌────────────────────────────────────────────────────────────────────┐  ││  │  │
│  │  │  │  │                      Your Workloads                                │  ││  │  │
│  │  │  │  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────────┐    │  ││  │  │
│  │  │  │  │  │ blog-api     │ │ blog-ui      │ │ blog-consumer            │    │  ││  │  │
│  │  │  │  │  │ (Pod)        │ │ (Pod)        │ │ (Pod)                    │    │  ││  │  │
│  │  │  │  │  └──────────────┘ └──────────────┘ └──────────────────────────┘    │  ││  │  │
│  │  │  │  └────────────────────────────────────────────────────────────────────┘  ││  │  │
│  │  │  └──────────────────────────────────────────────────────────────────────────┘│  │  │
│  │  │                                                                              │  │  │
│  │  │  SSH Access (:22) ──────────────────────────────► VPN only (10.10.0.0/24)    │  │  │
│  │  │  K8s API (:6443) ───────────────────────────────► VPN only (10.10.0.0/24)    │  │  │
│  │  │  HTTP/HTTPS (:80/:443) ─────────────────────────► Public (0.0.0.0/0)         │  │  │
│  │  │  WireGuard (:51820/UDP) ────────────────────────► Public (0.0.0.0/0)         │  │  │
│  │  └──────────────────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                               │
│  ┌────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                              Internet Gateway                                      │  │
│  └────────────────────────────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          │
┌─────────────────────────────────────────┴───────────────────────────────────────────────┐
│                                   VPN CLIENTS                                           │
│                                                                                         │
│  ┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐          │
│  │       user1         │    │       user2         │    │       user3         │          │
│  │   IP: 10.10.0.2     │    │   IP: 10.10.0.3     │    │   IP: 10.10.0.4     │          │
│  │                     │    │                     │    │                     │          │
│  │  ┌───────────────┐  │    │  ┌───────────────┐  │    │  ┌───────────────┐  │          │
│  │  │ WireGuard     │  │    │  │ WireGuard     │  │    │  │ WireGuard     │  │          │
│  │  │ Client        │  │    │  │ Client        │  │    │  │ Client        │  │          │
│  │  └───────┬───────┘  │    │  └───────┬───────┘  │    │  └───────┬───────┘  │          │
│  │          │          │    │          │          │    │          │          │          │
│  │  ┌───────▼───────┐  │    │  ┌───────▼───────┐  │    │  ┌───────▼───────┐  │          │
│  │  │   kubectl     │  │    │  │   kubectl     │  │    │  │   kubectl     │  │          │
│  │  │   ssh         │  │    │  │   ssh         │  │    │  │   ssh         │  │          │
│  │  └───────────────┘  │    │  └───────────────┘  │    │  └───────────────┘  │          │
│  └─────────────────────┘    └─────────────────────┘    └─────────────────────┘          │
│                                                                                         │
│  Access via VPN:                                                                        │
│    • SSH:     ssh ubuntu@10.10.0.1                                                      │
│    • kubectl: kubectl --server=https://10.10.0.1:6443 get nodes                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              PUBLIC USERS (Web Traffic)                                 │
│                                                                                         │
│    Browser ──► https://your-domain.com ──► Elastic IP ──► Traefik ──► Your Apps         │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
